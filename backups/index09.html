<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Interactive Timeline with Duration</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet"/>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-4">

  <h1 class="text-2xl font-bold mb-4">Interactive Timeline</h1>

  <!-- Timeline container -->
  <div id="timeline" class="w-full max-w-4xl h-96 bg-white rounded-lg shadow-md mb-6"></div>

  <!-- Form -->
  <div class="w-full max-w-4xl bg-white rounded-lg shadow-md p-4 mb-6">
    <h2 class="text-lg font-semibold mb-2" id="form-title">Add Event</h2>
    <form id="event-form" class="space-y-3">
      <div>
        <label for="event-date" class="block text-sm font-medium text-gray-700">Date/Time</label>
        <input type="datetime-local" id="event-date" required
               class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
      </div>
      <div>
        <label for="event-description" class="block text-sm font-medium text-gray-700">Description</label>
        <input type="text" id="event-description" required
               class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
      </div>
      <div>
        <label for="event-duration" class="block text-sm font-medium text-gray-700">Duration (minutes)</label>
        <input type="number" id="event-duration" min="0" value="0"
               class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
      </div>
      <div class="flex space-x-2">
        <input type="button" value="Save" onclick="handleAddOrUpdateEvent()" 
               class="px-4 py-2 bg-indigo-600 text-white rounded-lg cursor-pointer">
        <input type="button" value="Cancel" onclick="resetForm()" 
               class="px-4 py-2 bg-gray-400 text-white rounded-lg cursor-pointer">
      </div>
    </form>
  </div>

  <!-- Actions -->
  <div class="w-full max-w-4xl flex justify-between">
    <input type="button" value="Export Timeline" onclick="exportTimeline()" 
           class="px-4 py-2 bg-green-600 text-white rounded-lg cursor-pointer">
    <input type="file" id="import-file" accept=".json" class="hidden" onchange="importTimeline(event)">
    <input type="button" value="Import Timeline" onclick="document.getElementById('import-file').click()" 
           class="px-4 py-2 bg-blue-600 text-white rounded-lg cursor-pointer">
  </div>

  <script>
    let timeline = null;
    let timelineData = [];
    let editingId = null;

    function generateId() {
      return 'id-' + Math.random().toString(36).substr(2, 9);
    }

    function handleAddOrUpdateEvent() {
      const dateValue = document.getElementById('event-date').value;
      const description = document.getElementById('event-description').value.trim();
      const durationMinutes = parseInt(document.getElementById('event-duration').value, 10) || 0;

      if (!dateValue || !description) {
        alert("Please enter both date and description.");
        return;
      }

      const date = new Date(dateValue);

      if (editingId) {
        const index = timelineData.findIndex(d => d.id === editingId);
        if (index !== -1) {
          timelineData[index].date = date;
          timelineData[index].description = description;
          timelineData[index].duration = durationMinutes;
        }
      } else {
        timelineData.push({
          id: generateId(),
          date: date,
          description: description,
          duration: durationMinutes
        });
      }

      resetForm();
      drawTimeline();
    }

    function editEvent(id) {
      const d = timelineData.find(item => item.id === id);
      if (!d) return;

      document.getElementById('event-date').value = d.date.toISOString().slice(0, 16);
      document.getElementById('event-description').value = d.description;
      document.getElementById('event-duration').value = d.duration || 0;

      editingId = id;
      document.getElementById('form-title').textContent = "Edit Event";
    }

    function deleteEvent(id) {
      timelineData = timelineData.filter(d => d.id !== id);
      drawTimeline();
    }

    function resetForm() {
      document.getElementById('event-form').reset();
      editingId = null;
      document.getElementById('form-title').textContent = "Add Event";
    }

    function drawTimeline() {
      const container = document.getElementById('timeline');

      const visJsItems = timelineData.map(d => {
        const start = d.date;
        const hasDuration = d.duration && d.duration > 0;
        const end = hasDuration ? new Date(start.getTime() + d.duration * 60000) : null;

        return {
          id: d.id,
          content: `<div>
                      <div>${d.description}${hasDuration ? ` (${d.duration}m)` : ""}</div>
                      <div class="text-xs text-gray-500">
                        <a href="#" onclick="editEvent('${d.id}')">Edit</a> | 
                        <a href="#" onclick="deleteEvent('${d.id}')">Delete</a>
                      </div>
                    </div>`,
          start: start,
          end: end,
          type: hasDuration ? 'range' : 'point'
        };
      });

      const items = new vis.DataSet(visJsItems);
      const options = { editable: false };

      if (timeline) {
        timeline.setItems(items);
      } else {
        timeline = new vis.Timeline(container, items, options);
      }
    }

    function exportTimeline() {
      const serializableData = timelineData.map(d => ({
        id: d.id,
        date: d.date.toISOString(),
        description: d.description,
        duration: d.duration || 0
      }));
      const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(serializableData, null, 2));
      const dlAnchor = document.createElement('a');
      dlAnchor.setAttribute("href", dataStr);
      dlAnchor.setAttribute("download", "timeline.json");
      dlAnchor.click();
    }

    function importTimeline(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          timelineData = data.map(item => ({
            id: item.id || generateId(),
            date: new Date(item.date),
            description: item.description || "Untitled Event",
            duration: item.duration ? parseInt(item.duration, 10) : 0
          }));
          drawTimeline();
        } catch (err) {
          alert("Error parsing JSON file.");
        }
      };
      reader.readAsText(file);
    }

    // Init
    drawTimeline();
  </script>
</body>
</html>
