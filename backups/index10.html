<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interactive Vis.js Timeline</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f7f7f7;
      margin: 0;
      padding: 16px;
    }
    .card {
      background: white;
      padding: 16px;
      border: 1px solid #ddd;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    .timeline-box {
      width: 100%;
      height: 350px;
      background: white;
      border: 1px solid #ddd;
      border-radius: 10px;
    }
    .vis-item {
      border-radius: 6px;
      border: 2px solid #4f46e5;
      background-color: #6366f1;
      color: white;
      font-weight: bold;
      padding: 4px 8px;
      font-size: 14px;
    }
    .vis-item.vis-selected {
      border-color: #f59e0b !important;
      background-color: #fbbf24 !important;
    }
    label {
      font-size: 14px;
      display: block;
      margin-bottom: 4px;
    }
    input, textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-bottom: 10px;
      font-size: 14px;
    }
    input[type=button], input[type=submit] {
      padding: 8px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }
    .btn-blue { background: #4f46e5; color: white; }
    .btn-red { background: #e53e3e; color: white; }
    .btn-gray { background: #e2e8f0; color: black; }
    .btn-green { background: #16a34a; color: white; }
    .flex { display: flex; gap: 8px; flex-wrap: wrap; }
    .modal {
      position: fixed;
      top:0; left:0; right:0; bottom:0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      max-width: 400px;
      width: 90%;
    }
  </style>
</head>
<body>

  <h1 style="font-size: 24px; font-weight: bold; margin-bottom: 16px;">Interactive Timeline Editor</h1>

  <!-- Timeline -->
  <div id="myTimeline" class="timeline-box"></div>

  <!-- Event Form -->
  <div class="card">
    <h2 id="myFormTitle" style="font-size: 18px; font-weight: bold; margin-bottom: 10px;">Add Event</h2>
    <form id="myForm">
      <label for="myEventDate">Date/Time</label>
      <input type="datetime-local" id="myEventDate" required>

      <label for="myEventDesc">Description</label>
      <textarea id="myEventDesc" rows="2" maxlength="100" required></textarea>

      <label for="myEventDuration">Duration (minutes)</label>
      <input type="number" id="myEventDuration" min="0" value="0">

      <div class="flex">
        <input type="submit" id="mySubmitBtn" value="Add Event" class="btn-blue">
        <input type="button" id="myDeleteBtn" value="Delete Event" class="btn-red" style="display:none;">
        <input type="button" id="myCancelBtn" value="Cancel Edit" class="btn-gray" style="display:none;">
      </div>
    </form>
  </div>

  <!-- Export / Import -->
  <div class="card flex">
    <input type="button" value="Export JSON" onclick="myExport()" class="btn-green">
    <input type="file" id="myImportFile" accept=".json" style="display:none;" onchange="myImport(event)">
    <input type="button" value="Import JSON" onclick="document.getElementById('myImportFile').click()" class="btn-blue">
    <input type="button" value="Show Raw Data" onclick="myShowRaw()" class="btn-gray">
  </div>

  <!-- Raw JSON Area -->
  <div class="card" id="myRawCard" style="display:none;">
    <h2 style="font-size:16px; font-weight:bold; margin-bottom:8px;">Raw Timeline Data</h2>
    <textarea id="myRawText" rows="6"></textarea>
    <input type="button" value="Load from Raw JSON" onclick="myLoadRaw()" class="btn-green" style="margin-top:8px;">
  </div>

  <!-- Modal -->
  <div id="myModal" class="modal">
    <div class="modal-content">
      <h3 id="myModalTitle" style="margin-bottom:10px;">Event</h3>
      <p id="myModalText"></p>
      <div class="flex" style="margin-top:10px;">
        <input type="button" value="Edit" onclick="myModalEdit()" class="btn-blue">
        <input type="button" value="Delete" onclick="myModalDelete()" class="btn-red">
        <input type="button" value="Close" onclick="myCloseModal()" class="btn-gray">
      </div>
    </div>
  </div>

<script>
  let myTimeline = null;
  let myData = [];
  let myEditingId = null;
  let myModalId = null;

  function myGenerateId() {
    return 'id-' + Math.random().toString(36).substr(2, 9);
  }

  function myDraw() {
    const container = document.getElementById('myTimeline');
    const items = myData.map(d => {
      const start = d.date;
      const hasDuration = d.duration && d.duration > 0;
      const end = hasDuration ? new Date(start.getTime() + d.duration * 60000) : null;
      return {
        id: d.id,
        content: d.description + (hasDuration ? ` (${d.duration}m)` : ""),
        start: start,
        end: end,
        type: hasDuration ? 'range' : 'point'
      };
    });
    const dataset = new vis.DataSet(items);
    const options = { selectable: true };
    if (!myTimeline) {
      myTimeline = new vis.Timeline(container, dataset, options);
      myTimeline.on('select', props => {
        if (props.items.length > 0) {
          myOpenModal(props.items[0]);
        }
      });
    } else {
      myTimeline.setItems(dataset);
    }
  }

  document.getElementById('myForm').onsubmit = function(e) {
    e.preventDefault();
    const dateValue = document.getElementById('myEventDate').value;
    const desc = document.getElementById('myEventDesc').value.trim();
    const dur = parseInt(document.getElementById('myEventDuration').value, 10) || 0;
    if (!dateValue || !desc) { alert("Fill all fields"); return; }
    const date = new Date(dateValue);
    if (myEditingId) {
      const i = myData.findIndex(d => d.id === myEditingId);
      if (i !== -1) {
        myData[i].date = date;
        myData[i].description = desc;
        myData[i].duration = dur;
      }
    } else {
      myData.push({ id: myGenerateId(), date: date, description: desc, duration: dur });
    }
    myResetForm();
    myDraw();
  };

  function myResetForm() {
    document.getElementById('myForm').reset();
    document.getElementById('myEventDuration').value = 0;
    myEditingId = null;
    document.getElementById('myFormTitle').textContent = "Add Event";
    document.getElementById('myDeleteBtn').style.display = "none";
    document.getElementById('myCancelBtn').style.display = "none";
    document.getElementById('mySubmitBtn').value = "Add Event";
  }

  function myEdit(id) {
    const d = myData.find(x => x.id === id);
    if (!d) return;
    document.getElementById('myEventDate').value = d.date.toISOString().slice(0,16);
    document.getElementById('myEventDesc').value = d.description;
    document.getElementById('myEventDuration').value = d.duration || 0;
    myEditingId = id;
    document.getElementById('myFormTitle').textContent = "Edit Event";
    document.getElementById('myDeleteBtn').style.display = "inline-block";
    document.getElementById('myCancelBtn').style.display = "inline-block";
    document.getElementById('mySubmitBtn').value = "Save Event";
  }

  document.getElementById('myDeleteBtn').onclick = function() {
    if (myEditingId) {
      myData = myData.filter(d => d.id !== myEditingId);
      myResetForm();
      myDraw();
    }
  };
  document.getElementById('myCancelBtn').onclick = myResetForm;

  function myExport() {
    const out = myData.map(d => ({
      id: d.id, date: d.date.toISOString(),
      description: d.description, duration: d.duration || 0
    }));
    const blob = new Blob([JSON.stringify(out,null,2)], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = "timeline.json"; a.click();
    URL.revokeObjectURL(url);
  }

  function myImport(e) {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = ev => {
      try {
        const arr = JSON.parse(ev.target.result);
        myData = arr.map(x => ({
          id: x.id || myGenerateId(),
          date: new Date(x.date),
          description: x.description || "Untitled",
          duration: parseInt(x.duration)||0
        }));
        myDraw();
      } catch { alert("Invalid JSON"); }
    };
    reader.readAsText(file);
  }

  function myShowRaw() {
    document.getElementById('myRawCard').style.display = "block";
    document.getElementById('myRawText').value = JSON.stringify(myData.map(d=>({
      id:d.id,date:d.date.toISOString(),description:d.description,duration:d.duration||0
    })), null, 2);
  }

  function myLoadRaw() {
    try {
      const txt = document.getElementById('myRawText').value;
      const arr = JSON.parse(txt);
      myData = arr.map(x => ({
        id: x.id||myGenerateId(),
        date:new Date(x.date),
        description:x.description||"Untitled",
        duration:parseInt(x.duration)||0
      }));
      myDraw();
    } catch { alert("Bad JSON"); }
  }

  function myOpenModal(id) {
    myModalId = id;
    const d = myData.find(x => x.id===id);
    if (!d) return;
    document.getElementById('myModalTitle').textContent = d.description;
    document.getElementById('myModalText').textContent =
      "When: " + d.date.toLocaleString() + (d.duration? " ("+d.duration+" min)": "");
    document.getElementById('myModal').style.display="flex";
  }
  function myCloseModal(){ document.getElementById('myModal').style.display="none"; }
  function myModalEdit(){ myCloseModal(); myEdit(myModalId); }
  function myModalDelete(){
    myData = myData.filter(d=>d.id!==myModalId);
    myCloseModal();
    myDraw();
  }

  myDraw();
</script>
</body>
</html>
